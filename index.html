<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Biochimie Quiz - Glucides</title>
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Source Sans 3',-apple-system,BlinkMacSystemFont,sans-serif;font-style:normal}
body{background:#f8f9fa;color:#111827;min-height:100vh;display:flex;justify-content:center}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.wrap{width:100%;max-width:620px;padding:28px 20px;min-height:100vh}
.header{text-align:center;margin-bottom:36px}
.header h1{font-size:22px;font-weight:800;color:#111827;letter-spacing:-0.5px}
.header .sub{font-size:13px;color:#9ca3af;margin-top:4px;font-weight:500}
.back-btn{font-size:13px;color:#6b7280;background:none;border:none;cursor:pointer;margin-top:8px;font-weight:600}
.back-btn:hover{color:#374151}

/* Progress */
.progress{width:100%;margin-bottom:28px}
.progress-top{display:flex;justify-content:space-between;margin-bottom:10px;font-size:13px;font-weight:600;color:#6b7280}
.progress-top .correct{color:#16a34a}
.progress-top .wrong{color:#dc2626}
.progress-bar{width:100%;height:8px;border-radius:99px;background:#e5e7eb;box-shadow:inset 0 1px 3px rgba(0,0,0,0.06)}
.progress-fill{height:100%;border-radius:99px;background:#111827;transition:width 0.5s ease}

/* Cards */
.card{background:#fff;border:1px solid #e5e7eb;border-radius:18px;box-shadow:0 2px 12px rgba(0,0,0,0.05);padding:22px 24px;margin-bottom:24px}
.q-label{font-size:12px;font-weight:700;color:#9ca3af;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:14px}
.q-text{font-size:16px;font-weight:700;color:#111827;line-height:1.7}

/* Options */
.options{display:flex;flex-direction:column;gap:10px;margin-bottom:24px}
.option{display:flex;align-items:flex-start;gap:14px;padding:16px 18px;border-radius:14px;cursor:pointer;transition:all 0.2s ease;font-size:15px;line-height:1.65;font-weight:500;user-select:none;border:1px solid #e5e7eb;background:#fff;box-shadow:0 1px 4px rgba(0,0,0,0.04)}
.option:hover:not(.disabled){border-color:#d1d5db;box-shadow:0 2px 8px rgba(0,0,0,0.06)}
.option.selected{border:2px solid #374151;background:#f9fafb;box-shadow:0 2px 10px rgba(0,0,0,0.08)}
.option.correct-answer{border:2px solid #16a34a;background:#f0fdf4;box-shadow:0 2px 10px rgba(22,163,74,0.10)}
.option.wrong-answer{border:2px solid #dc2626;background:#fef2f2;box-shadow:0 2px 10px rgba(220,38,38,0.08)}
.option.dimmed{opacity:0.45}
.option.disabled{cursor:default}

.badge{width:32px;height:32px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;flex-shrink:0;transition:all 0.2s ease;background:#f3f4f6;color:#6b7280}
.option.selected .badge{background:#111827;color:#fff}
.option.correct-answer .badge{background:#16a34a;color:#fff}
.option.wrong-answer .badge{background:#dc2626;color:#fff}
.option.dimmed .badge{background:#f3f4f6;color:#d1d5db}

.option-text{color:#4b5563;font-weight:500}
.option.selected .option-text{color:#111827}
.option.correct-answer .option-text{color:#15803d;font-weight:700}
.option.wrong-answer .option-text{color:#b91c1c;font-weight:700}
.option.dimmed .option-text{color:#9ca3af}

/* Explanation */
.explanation{animation:fadeUp 0.3s ease both;margin-bottom:24px;padding:20px 22px;border-radius:16px}
.explanation.is-correct{background:#f0fdf4;border:1px solid #bbf7d0;box-shadow:0 2px 12px rgba(22,163,74,0.06)}
.explanation.is-wrong{background:#fef2f2;border:1px solid #fecaca;box-shadow:0 2px 12px rgba(220,38,38,0.06)}
.explanation .icon-badge{width:28px;height:28px;border-radius:14px;color:#fff;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:800;flex-shrink:0}
.explanation .icon-badge.green{background:#16a34a}
.explanation .icon-badge.red{background:#dc2626}
.explanation .status{font-size:14px;font-weight:800;letter-spacing:0.5px;text-transform:uppercase}
.explanation .status.green{color:#15803d}
.explanation .status.red{color:#b91c1c}
.explanation .body{font-size:14px;color:#4b5563;line-height:1.7;font-weight:500;margin-top:10px}
.explanation .body strong{font-weight:800;color:#111827}

/* Buttons */
.btn{padding:16px;border-radius:14px;font-size:15px;font-weight:800;cursor:pointer;transition:all 0.2s ease;width:100%;border:none}
.btn-primary{background:#111827;color:#fff;box-shadow:0 4px 16px rgba(0,0,0,0.12)}
.btn-primary:hover{background:#1f2937}
.btn-primary:disabled{background:#e5e7eb;color:#9ca3af;box-shadow:none;cursor:default}
.btn-secondary{background:#fff;color:#374151;border:2px solid #e5e7eb;box-shadow:0 2px 8px rgba(0,0,0,0.04)}
.btn-secondary:hover{background:#f9fafb;border-color:#d1d5db}
.btn-row{display:flex;gap:10px}
.btn-row .btn{flex:1;padding:15px;font-size:14px}

.retry-info{margin-top:18px;font-size:13px;color:#9ca3af;text-align:center;font-weight:600}

/* Home */
.home-desc{text-align:center;color:#6b7280;font-size:15px;margin-bottom:36px;line-height:1.7;font-weight:500}
.series-btn{width:100%;padding:24px 28px;border-radius:18px;border:1px solid #e5e7eb;background:#fff;cursor:pointer;margin-bottom:14px;text-align:left;transition:all 0.2s ease;display:flex;align-items:center;gap:20px;box-shadow:0 2px 12px rgba(0,0,0,0.04)}
.series-btn:hover{box-shadow:0 6px 24px rgba(0,0,0,0.08);transform:translateY(-2px)}
.series-num{width:52px;height:52px;border-radius:14px;background:#f3f4f6;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:800;color:#374151;flex-shrink:0}
.series-info{flex:1}
.series-info .name{font-size:17px;font-weight:800;color:#111827;margin-bottom:4px}
.series-info .desc{font-size:14px;color:#374151;font-weight:600;margin-bottom:2px}
.series-info .meta{font-size:13px;color:#9ca3af;font-weight:500}
.series-arrow{color:#9ca3af;font-size:20px;font-weight:600}

.how-it-works{margin-top:36px;padding:24px;border-radius:18px;background:#fff;border:1px solid #f3f4f6;box-shadow:0 1px 6px rgba(0,0,0,0.03)}
.how-it-works h3{font-size:14px;font-weight:800;color:#374151;margin-bottom:14px}
.how-step{display:flex;gap:12px;align-items:flex-start;font-size:14px;color:#6b7280;font-weight:500;margin-bottom:10px;line-height:1.5}
.how-step .num{color:#111827;font-weight:800;font-size:13px;min-width:20px}

/* Results */
.results{display:flex;flex-direction:column;align-items:center;animation:fadeUp 0.5s ease both;padding:32px 0}
.grade-circle{width:120px;height:120px;border-radius:60px;background:#fff;box-shadow:0 8px 32px rgba(0,0,0,0.10);display:flex;align-items:center;justify-content:center;margin-bottom:24px}
.grade-letter{font-size:56px;font-weight:800}
.grade-label{font-size:14px;font-weight:600;color:#6b7280;letter-spacing:2px;text-transform:uppercase;margin-bottom:32px}
.stats-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;width:100%;max-width:420px;margin-bottom:36px}
.stat-card{background:#fff;border-radius:16px;padding:22px 14px;text-align:center;box-shadow:0 2px 12px rgba(0,0,0,0.06);border:1px solid #f3f4f6}
.stat-value{font-size:28px;font-weight:800}
.stat-label{font-size:11px;font-weight:600;color:#9ca3af;margin-top:6px;letter-spacing:1px;text-transform:uppercase}
.result-btns{display:flex;gap:12px;width:100%;max-width:420px}
.result-btns .btn{flex:1;padding:15px 20px;font-size:14px}

.hidden{display:none}
.anim{animation:fadeUp 0.4s ease both}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <h1>Biochimie Quiz</h1>
    <div class="sub">Métabolisme des Glucides - QCM</div>
    <button class="back-btn hidden" id="backBtn" onclick="goHome()">← Retour</button>
  </div>

  <!-- HOME -->
  <div id="homeScreen" class="anim">
    <p class="home-desc">Choisis ta série. Les questions sont mélangées aléatoirement.</p>
    <button class="series-btn" onclick="startSeries(1)">
      <div class="series-num">1</div>
      <div class="series-info">
        <div class="name">Série 1 (Q1-20)</div>
        <div class="desc">Digestion, Glycolyse & Cycle de Krebs</div>
        <div class="meta">Enzymes, régulation et transporteurs — 20 questions</div>
      </div>
      <div class="series-arrow">→</div>
    </button>
    <button class="series-btn" onclick="startSeries(2)">
      <div class="series-num">2</div>
      <div class="series-info">
        <div class="name">Série 2 (Q21-40)</div>
        <div class="desc">Chaîne respiratoire & Métabolismes spécifiques</div>
        <div class="meta">Néoglucogenèse, PPP, Glycogène, Galactose — 20 questions</div>
      </div>
      <div class="series-arrow">→</div>
    </button>
    
    <div class="how-it-works">
      <h3>Comment ça marche</h3>
      <div class="how-step"><span class="num">1.</span><span>Sélectionne toutes les affirmations VRAIES.</span></div>
      <div class="how-step"><span class="num">2.</span><span>Appuie sur Valider pour voir les explications.</span></div>
      <div class="how-step"><span class="num">3.</span><span>Si tu te trompes : « Repasser plus tard » remet la question en fin de série.</span></div>
    </div>
  </div>

  <!-- QUIZ -->
  <div id="quizScreen" class="hidden"></div>

  <!-- RESULTS -->
  <div id="resultScreen" class="hidden"></div>
</div>

<script>
// Q1 à Q20
const SERIES_1 = [
  {q:"Digestion des glucides : enzymes",o:{A:"L’α‑amylase salivaire coupe les liaisons α(1→4) au sein des chaînes.",B:"La pepsine participe à l’hydrolyse des polysaccharides.",C:"L’α‑amylase pancréatique agit dans l’intestin sur les liaisons α(1→4).",D:"L’α‑dextrinase (enzyme débranchante) hydrolyse surtout les liaisons α(1→6).",E:"L’α‑glucosidase libère du glucose à partir du maltose (liaisons α(1→4))."},a:["A","C","D","E"],ex:"B Faux : La pepsine est une enzyme protéolytique, pas glucidique."},
  {q:"Absorption intestinale : localisation",o:{A:"Le glucose est surtout absorbé dans le duodénum et le jéjunum.",B:"Seuls les monosaccharides peuvent être absorbés par les entérocytes.",C:"Les oligosaccharides sont toujours absorbés chez l’adulte par endocytose.",D:"Les glucides non digestibles sont éliminés dans les matières fécales.",E:"Le galactose est absorbé sans transporteur."},a:["A","B","D"],ex:"C Faux : Endocytose surtout chez le nouveau-né. E Faux : Le galactose nécessite SGLT/GLUT."},
  {q:"Transporteurs GLUT/SGLT : généralités",o:{A:"GLUT1 est présent dans les érythrocytes.",B:"GLUT2 est sur la membrane basolatérale et fait sortir le glucose de l’entérocyte.",C:"SGLT1 fonctionne par diffusion facilitée.",D:"GLUT4 est un transporteur du muscle strié nécessitant l’insuline.",E:"GLUT5 est le principal transporteur intestinal du fructose."},a:["A","B","D","E"],ex:"C Faux : SGLT1 est un transport actif (co-transport Na+)."},
  {q:"Test au D‑xylose",o:{A:"Le D‑xylose nécessite une digestion préalable.",B:"Le D‑xylose est éliminé dans les urines.",C:"Il explore la capacité d’absorption de la muqueuse digestive.",D:"Il sert à dépister une malabsorption (ex. perte de poids).",E:"Il évalue spécifiquement l’activité de l’amylase pancréatique."},a:["B","C","D"],ex:"A Faux : Monosaccharide directement absorbable. E Faux : Il n'évalue pas la digestion (amylase)."},
  {q:"Glycémie : définitions",o:{A:"La glycémie est le taux de glucose plasmatique.",B:"La glycémie à jeun se mesure 9–12 h après arrêt des repas.",C:"Valeurs normales à jeun : 0,70–1,10 g/L.",D:"La grossesse ne modifie jamais la glycémie.",E:"Hyperglycémie et hypoglycémie sont des variations pathologiques."},a:["A","B","C","E"],ex:"D Faux : La grossesse entraîne des variations physiologiques."},
  {q:"Glycolyse : caractéristiques",o:{A:"Elle se déroule dans le cytosol de toutes les cellules.",B:"Elle nécessite obligatoirement l’oxygène.",C:"Elle transforme le G6P en pyruvate.",D:"Elle comporte 10 étapes, en 2 phases.",E:"Elle comporte 3 réactions irréversibles."},a:["A","C","D","E"],ex:"B Faux : C'est une voie possible en anaérobiose."},
  {q:"Glycolyse : étapes irréversibles",o:{A:"Phosphorylation du glucose en G6P (hexokinase/glucokinase).",B:"Isomérisation G6P → F6P.",C:"Phosphorylation F6P → F1,6‑bisP (PFK‑1).",D:"Déshydratation 2‑phosphoglycérate → PEP.",E:"Transfert du phosphate du PEP vers l’ADP (pyruvate kinase)."},a:["A","C","E"],ex:"B est réversible. D (Enolase) est réversible."},
  {q:"Glycolyse : cofacteurs/points clés",o:{A:"La 1ère réaction nécessite ATP et Mg2+.",B:"La 3ème réaction (PFK‑1) nécessite Mg2+.",C:"La 6ème réaction utilise NAD+ comme coenzyme.",D:"La 9ème réaction ne nécessite aucun ion métallique.",E:"La 10ème réaction nécessite Mg2+ ou Mn2+."},a:["A","B","C","E"],ex:"D Faux : La 9ème réaction nécessite du Mg2+."},
  {q:"Produits globaux de la glycolyse",o:{A:"2 ATP (bilan net).",B:"2 NADH,H+.",C:"2 H2O.",D:"2 CO2.",E:"2 pyruvates."},a:["A","B","C","E"],ex:"D Faux : Pas de décarboxylation (pas de CO2) dans la glycolyse anaérobie."},
  {q:"Régulation : hexokinase vs glucokinase",o:{A:"L’hexokinase est inhibée par le glucose‑6‑phosphate.",B:"La glucokinase a une régulation allostérique majeure.",C:"La glucokinase est active quand la concentration en glucose est élevée.",D:"L’hexokinase favorise le métabolisme basal du glucose.",E:"La glucokinase a une forte affinité (Km très faible) pour le glucose."},a:["A","C","D"],ex:"B Faux. E Faux : Glucokinase a une faible affinité (Km élevé)."},
  {q:"Régulation de la glycolyse : PFK‑1 et pyruvate kinase",o:{A:"PFK‑1 est activée par l’AMP.",B:"PFK‑1 est activée par le fructose‑2,6‑bisphosphate.",C:"PFK‑1 est inhibée par l’ATP et le citrate.",D:"L’acétyl‑CoA inhibe la pyruvate kinase.",E:"Les acides gras à longue chaîne inhibent la pyruvate kinase."},a:["A","B","C","E"],ex:"D Faux : Dans le cours, l'Acétyl-CoA active la PK (rétrocontrôle positif) ou est inhibiteur selon le contexte, mais ici E est clairement Vrai."},
  {q:"Régulation hormonale (glycolyse)",o:{A:"L’insuline active PFK‑1.",B:"Le glucagon a un effet opposé à l’insuline sur la glycolyse.",C:"L’insuline active l’hexokinase/glucokinase.",D:"Le glucagon active la glycolyse dans le foie (tel quel).",E:"L’insuline active la pyruvate kinase."},a:["A","B","C","E"],ex:"D Faux : Le glucagon inhibe la glycolyse hépatique (favorise la néoglucogenèse)."},
  {q:"Déficit en pyruvate kinase (GR)",o:{A:"Les GR dépendent exclusivement de la glycolyse pour l’ATP.",B:"Le déficit entraîne une anémie hémolytique.",C:"La membrane des GR devient plus fragile, entraînant phagocytose.",D:"Le traitement cité est le mitapivat.",E:"Le déficit augmente fortement la phosphorylation oxydative des GR."},a:["A","B","C","D"],ex:"E Faux : Les GR n'ont pas de mitochondries, donc pas de phosphorylation oxydative."},
  {q:"Déficit en PFK musculaire (Tarui)",o:{A:"Accumulation de F6P et G6P.",B:"Accumulation d’un glycogène de structure anormale dans le muscle.",C:"Après effort : crampes et fatigabilité musculaire.",D:"Après effort : élévation marquée de l’acide lactique dans le sang.",E:"Pathologie appelée maladie de Tarui."},a:["A","B","C","E"],ex:"D Faux : Pas d'élévation marquée de lactate (blocage de la glycolyse)."},
  {q:"Fermentation lactique",o:{A:"Elle a lieu si la cellule est en hypoxie/anaérobiose.",B:"Pyruvate + NADH,H+ → lactate + NAD+.",C:"L’enzyme est la lactate déshydrogénase.",D:"Elle régénère le NAD+ permettant la poursuite de la glycolyse.",E:"Elle ne peut pas se produire dans les globules rouges."},a:["A","B","C","D"],ex:"E Faux : Elle est essentielle dans les GR (pas de mitochondries)."},
  {q:"Fermentation alcoolique",o:{A:"Elle se produit principalement chez les levures.",B:"Étape 1 : pyruvate → acétaldéhyde + CO2 (pyruvate décarboxylase).",C:"Étape 2 : acétaldéhyde + NADH,H+ → éthanol + NAD+ (alcool DH).",D:"C’est la voie principale des hépatocytes humains.",E:"Elle permet aussi de régénérer le NAD+."},a:["A","B","C","E"],ex:"D Faux : C'est une voie microbienne/végétale, pas humaine."},
  {q:"Pyruvate : oxaloacétate",o:{A:"Pyruvate + CO2 + ATP → oxaloacétate + ADP + Pi.",B:"Enzyme : pyruvate carboxylase.",C:"Cette réaction peut servir à la néoglucogenèse.",D:"Cette réaction ne consomme jamais d’ATP.",E:"Elle a lieu exclusivement dans le cytosol."},a:["A","B","C"],ex:"D Faux : Elle consomme 1 ATP. E Faux : Exclusivement mitochondriale."},
  {q:"Cycle de Krebs : généralités",o:{A:"Se déroule en aérobiose dans la matrice mitochondriale.",B:"Comprend 8 réactions.",C:"Produit 2 CO2 par tour (par acétyl‑CoA).",D:"Produit 3 NADH,H+ et 1 FADH2 par tour.",E:"Ne régénère pas l’oxaloacétate."},a:["A","B","C","D"],ex:"E Faux : L'oxaloacétate est régénéré en fin de cycle."},
  {q:"Cycle de Krebs : enzymes clés de régulation",o:{A:"Citrate synthase.",B:"Isocitrate déshydrogénase.",C:"α‑cétoglutarate déshydrogénase.",D:"Fumarase.",E:"Malate déshydrogénase."},a:["A","B","C"],ex:"D et E ne sont pas des enzymes clés limitantes/régulatrices majeures."},
  {q:"Régulation : citrate synthase",o:{A:"Dépend de la disponibilité en oxaloacétate et acétyl‑CoA.",B:"Inhibée par succinyl‑CoA (compétition avec acétyl‑CoA).",C:"Inhibée par ATP et citrate (produits).",D:"Activée par NADH.",E:"Insensible à la disponibilité en substrat."},a:["A","B","C"],ex:"D Faux (NADH inhibe). E Faux."}
];

// Q21 à Q40
const SERIES_2 = [
  {q:"Chaîne respiratoire : complexes et pompage",o:{A:"Le complexe I pompe 4 H+ vers l’espace intermembranaire.",B:"Le complexe II pompe des protons.",C:"Le complexe III pompe 4 H+.",D:"Le complexe IV pompe 2 H+.",E:"Le complexe V synthétise l’ATP grâce au gradient de protons."},a:["A","C","D","E"],ex:"B Faux : Le complexe II ne pompe pas de protons."},
  {q:"Inhibiteurs : chaîne respiratoire",o:{A:"Roténone inhibe le complexe I.",B:"Malonate inhibe le complexe II.",C:"Antimycine A inhibe le complexe III.",D:"Cyanure inhibe le complexe IV.",E:"Le CO inhibe le complexe III."},a:["A","B","C","D"],ex:"E Faux : Le CO inhibe le complexe IV."},
  {q:"Production d’ATP : flux de protons",o:{A:"1 NADH,H+ correspond à 10 H+ (I, III, IV).",B:"1 FADH2 correspond à 6 H+ (III, IV).",C:"2 H+ suffisent pour produire 1 ATP.",D:"4 H+ sont nécessaires pour produire 1 ATP.",E:"La chaîne respiratoire aboutit à H2O et ATP."},a:["A","B","D","E"],ex:"C Faux : Il faut 4 H+."},
  {q:"Navettes mitochondriales",o:{A:"La navette malate‑aspartate donne 1 NADH mitochondrial par NADH cytosolique.",B:"La navette glycérol‑phosphate convertit un NADH cytosolique en FADH2 mitochondrial.",C:"La navette malate‑aspartate est citée pour foie/cœur/reins/cerveau.",D:"La navette glycérol‑phosphate est citée pour muscle squelettique/cerveau.",E:"Ces navettes existent car la membrane interne est perméable au NADH."},a:["A","B","C","D"],ex:"E Faux : La membrane est IMPERMÉABLE au NADH, d'où la nécessité des navettes."},
  {q:"Voie des pentoses phosphates (PPP) : rôles",o:{A:"Produit du NADPH pour biosynthèses réductrices.",B:"Produit du ribose‑5‑phosphate pour nucléotides/acides nucléiques.",C:"Produit directement de l’ATP.",D:"Participe à la protection contre le stress oxydatif (GR, glutathion).",E:"Est une voie cytoplasmique anabolique."},a:["A","B","D","E"],ex:"C Faux : La PPP ne produit pas d'énergie (ATP)."},
  {q:"PPP : tissus actifs",o:{A:"Foie.",B:"Adipocytes.",C:"Glandes mammaires.",D:"Glandes surrénales.",E:"Uniquement dans les mitochondries."},a:["A","B","C","D"],ex:"E Faux : C'est une voie cytoplasmique."},
  {q:"PPP : régulation (G6PD)",o:{A:"La G6PD est l’enzyme clé régulatrice.",B:"Elle est activée par accumulation de NADP+.",C:"Elle est inhibée par accumulation de NADPH.",D:"Toute la voie (oxydative + non oxydative) est régulée au même niveau.",E:"Demande élevée en NADPH → catabolisme du G6P via PPP."},a:["A","B","C","E"],ex:"D Faux : Seule la partie oxydative est strictement régulée."},
  {q:"Déficit en G6PD : conséquences",o:{A:"↓ NADPH.",B:"↓ glutathion réduit (GSH).",C:"↑ stress oxydatif et fragilité du globule rouge.",D:"Hémolyse → anémie hémolytique.",E:"Protection contre H2O2 améliorée."},a:["A","B","C","D"],ex:"E Faux : La protection antioxydante est diminuée."},
  {q:"Néoglucogenèse : généralités",o:{A:"Synthèse de glucose à partir de composés non glucidiques.",B:"Se déroule principalement dans le foie (≈90%).",C:"Se déroule aussi dans le rein (≈10%).",D:"Est simplement l’inverse exact de la glycolyse.",E:"Comprend 12 réactions dont 5 spécifiques irréversibles."},a:["A","B","C","E"],ex:"D Faux : Ce n'est pas l'inverse exact (contournement des étapes irréversibles)."},
  {q:"Précurseurs de la néoglucogenèse",o:{A:"Lactate.",B:"Alanine.",C:"Glycérol.",D:"Acides aminés glucoformateurs.",E:"Leucine (comme AA glucoformateur)."},a:["A","B","C","D"],ex:"E Faux : La leucine (et lysine) sont cétogènes, pas glucoformateurs."},
  {q:"Néoglucogenèse : enzymes spécifiques",o:{A:"Pyruvate carboxylase (mitochondriale).",B:"PEP carboxykinase (oxaloacétate → PEP).",C:"Fructose‑1,6‑bisphosphatase.",D:"Glucose‑6‑phosphatase (hépatique surtout, aussi rénale).",E:"Aldolase (comme enzyme spécifique irréversible)."},a:["A","B","C","D"],ex:"E Faux : L'aldolase est réversible et commune à la glycolyse."},
  {q:"Néoglucogenèse : coût énergétique",o:{A:"1 glucose à partir de 2 pyruvates consomme 6 ATP.",B:"Elle consomme 2 NADH,H+ (équivalant à 5 ATP).",C:"Total annoncé : 11 ATP équivalents par glucose synthétisé.",D:"Elle produit un gain net d’ATP.",E:"Le coût énergétique est identique à celui de la glycolyse."},a:["A","B","C"],ex:"D Faux (consomme). E Faux (Glycolyse produit, Néo consomme)."},
  {q:"Régulation : glycolyse vs néoglucogenèse (F2,6BP)",o:{A:"F2,6BP active PFK‑1.",B:"F2,6BP inhibe la fructose‑1,6‑bisphosphatase.",C:"Glucagon ↓ F2,6BP → stimule néoglucogenèse.",D:"Insuline ↑ F2,6BP → stimule glycolyse.",E:"F2,6BP stimule simultanément glycolyse et néoglucogenèse."},a:["A","B","C","D"],ex:"E Faux : Effets opposés (régulation réciproque)."},
  {q:"Déficits : Von Gierke",o:{A:"Déficit en glucose‑6‑phosphatase.",B:"Incapacité de convertir G6P en glucose libre.",C:"Hypoglycémie sévère surtout après jeûne.",D:"Hépatomégalie (accumulation de glycogène).",E:"Alcalose lactique."},a:["A","B","C","D"],ex:"E Faux : C'est une Acidose lactique."},
  {q:"Métabolisme du fructose : transport/absorption",o:{A:"Transport facilité via GLUT2 et GLUT5.",B:"GLUT5 est le principal transporteur intestinal du fructose.",C:"Le fructose déclenche la sécrétion d’insuline comme le glucose.",D:"Son absorption intestinale est décrite comme active (Na+ et ATP).",E:"Il ne peut pas être métabolisé en tissus extra‑hépatiques."},a:["A","B","D"],ex:"C Faux (ne déclenche pas insuline). E Faux (Possible via hexokinase)."},
  {q:"Métabolisme du fructose : foie vs tissus",o:{A:"Au foie, la fructokinase forme du fructose‑1‑phosphate.",B:"Le fructose est massivement stocké en glycogène hépatique.",C:"En tissus extra‑hépatiques, l’hexokinase peut former du fructose‑6‑P.",D:"Le fructose peut alimenter la glycolyse via fructose‑6‑P.",E:"La fructokinase est citée comme enzyme majoritaire hépatique."},a:["A","C","D","E"],ex:"B Faux : Il est rapidement utilisé (lipogenèse, énergie), peu stocké."},
  {q:"Anomalies du fructose",o:{A:"Intolérance héréditaire : déficit en aldolase B.",B:"Intolérance héréditaire : accumulation toxique de fructose‑1‑P.",C:"Signes : vomissements, hypoglycémie, hépatomégalie, retard de croissance.",D:"Fructosurie : déficit en fructokinase, souvent asymptomatique.",E:"Fructosurie : déficit en lactase."},a:["A","B","C","D"],ex:"E Faux : Lactase concerne le lactose."},
  {q:"Galactose : digestion/transport",o:{A:"Le lactose est hydrolysé par β‑galactosidase intestinale.",B:"Entrée dans l’entérocyte via SGLT1 (Na+/sucre).",C:"Sortie basolatérale via GLUT2.",D:"GLUT1 permet l’entrée dans toutes les cellules.",E:"Le galactose n’a aucun rôle biologique structural."},a:["A","B","C","D"],ex:"E Faux : Précurseur important (glycolipides, glycoprotéines)."},
  {q:"Galactosémies : types",o:{A:"Type I (congénitale sévère) : déficit en galactose‑1‑P uridyltransférase.",B:"Type II : déficit en galactokinase, cataractes précoces (galactitol).",C:"Type III : déficit en épimérase UDP‑galactose.",D:"Le traitement de la galactosémie sévère est suppression du galactose à vie.",E:"Type I : maladie toujours asymptomatique."},a:["A","B","C","D"],ex:"E Faux : Forme très sévère."},
  {q:"Glycogène : structure + métabolisme",o:{A:"Polymère de D‑glucose avec liaisons α(1→4) et branches α(1→6).",B:"Les branches apparaissent tous les 8 à 12 résidus de glucose.",C:"Foie : réserve pour l’organisme entier (≈1 jour, stock vite épuisable ~24 h).",D:"Muscle : réserve pour les propres besoins énergétiques du muscle.",E:"Il n’existe qu’une seule voie liée au glycogène (uniquement la synthèse)."},a:["A","B","C","D"],ex:"E Faux : Il y a synthèse (glycogénogenèse) et dégradation (glycogénolyse)."}
];

let state = {
  screen: "home",
  seriesName: "",
  questions: [],
  idx: 0,
  selected: [],
  validated: false,
  isCorrect: false,
  correct: 0,
  wrong: 0,
  retryQueue: [],
  retryCount: 0
};

function shuffle(a) {
  const b = [...a];
  for (let i = b.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [b[i], b[j]] = [b[j], b[i]];
  }
  return b;
}

function startSeries(n) {
  const data = n === 1 ? SERIES_1 : SERIES_2;
  state = {
    screen: "quiz",
    seriesName: "Série " + n,
    seriesNum: n,
    questions: shuffle(data),
    idx: 0,
    selected: [],
    validated: false,
    isCorrect: false,
    correct: 0,
    wrong: 0,
    retryQueue: [],
    retryCount: 0
  };
  render();
}

function goHome() {
  state.screen = "home";
  render();
}

function toggleOption(letter) {
  if (state.validated) return;
  const i = state.selected.indexOf(letter);
  if (i > -1) state.selected.splice(i, 1);
  else state.selected.push(letter);
  render();
}

function validate() {
  if (state.selected.length === 0 || state.validated) return;
  const q = state.questions[state.idx];
  // Check correctness: selected must equal answers exactly
  const ok = state.selected.length === q.a.length && state.selected.every(s => q.a.includes(s));
  
  state.isCorrect = ok;
  state.validated = true;
  if (ok) state.correct++;
  else state.wrong++;
  render();
}

function next() {
  if (state.idx + 1 < state.questions.length) {
    state.idx++;
    state.selected = [];
    state.validated = false;
  } else if (state.retryQueue.length > 0) {
    // Load retries
    const nq = shuffle(state.retryQueue);
    state.questions = state.questions.concat(nq);
    state.retryQueue = [];
    state.idx++;
    state.selected = [];
    state.validated = false;
  } else {
    state.screen = "result";
  }
  render();
}

function retryLater() {
  state.retryQueue.push(state.questions[state.idx]);
  state.retryCount++;
  next();
}

function render() {
  const home = document.getElementById("homeScreen");
  const quiz = document.getElementById("quizScreen");
  const result = document.getElementById("resultScreen");
  const back = document.getElementById("backBtn");

  home.className = state.screen === "home" ? "anim" : "hidden";
  quiz.className = state.screen === "quiz" ? "anim" : "hidden";
  result.className = state.screen === "result" ? "anim" : "hidden";
  back.className = state.screen === "quiz" ? "back-btn" : "back-btn hidden";

  if (state.screen === "quiz") renderQuiz();
  if (state.screen === "result") renderResult();
}

function renderQuiz() {
  const q = state.questions[state.idx];
  const total = state.questions.length;
  // Progress bar calculation based on current index vs total
  const pct = total > 0 ? (state.idx / total) * 100 : 0;
  
  // Available options for this question
  const letters = ["A", "B", "C", "D", "E"].filter(l => q.o[l]);

  let html = `
    <div class="progress">
      <div class="progress-top">
        <span>Question ${state.idx + 1} sur ${total}</span>
        <span><span class="correct">Correct : ${state.correct}</span>&nbsp;&nbsp;&nbsp;<span class="wrong">Faux : ${state.wrong}</span></span>
      </div>
      <div class="progress-bar"><div class="progress-fill" style="width:${pct}%"></div></div>
    </div>
    <div class="q-label">${state.seriesName} — Q${state.idx + 1}</div>
    <div class="card"><div class="q-text">${q.q}</div></div>
    <div class="options">`;

  letters.forEach(l => {
    let cls = "option";
    let textColor = "#4b5563";
    let textWeight = 500;
    const isSel = state.selected.includes(l);
    const isAns = q.a.includes(l);

    if (!state.validated) {
      if (isSel) {
        cls += " selected";
        textColor = "#111827";
      }
    } else {
      cls += " disabled";
      if (isAns) {
        cls += " correct-answer";
        textColor = "#15803d";
        textWeight = 700;
      } else if (isSel && !isAns) {
        cls += " wrong-answer";
        textColor = "#b91c1c";
        textWeight = 700;
      } else {
        cls += " dimmed";
      }
    }

    html += `<div class="${cls}" onclick="toggleOption('${l}')">
      <div class="badge">${l}</div>
      <div class="option-text" style="color:${textColor};font-weight:${textWeight}">${q.o[l]}</div>
    </div>`;
  });

  html += `</div>`;

  if (state.validated) {
    const ec = state.isCorrect ? "is-correct" : "is-wrong";
    const ic = state.isCorrect ? "green" : "red";
    const sym = state.isCorrect ? "✓" : "✗";
    const label = state.isCorrect ? "Correct" : "Incorrect";
    html += `<div class="explanation ${ec}">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
        <div class="icon-badge ${ic}">${sym}</div>
        <span class="status ${ic}">${label}</span>
      </div>
      <div class="body"><strong>Réponses attendues : ${q.a.join(", ")}</strong><br>${q.ex}</div>
    </div>`;
  }

  if (!state.validated) {
    const dis = state.selected.length === 0;
    html += `<button class="btn btn-primary" ${dis ? "disabled" : ""} onclick="validate()">Valider</button>`;
  } else {
    html += `<div class="btn-row">`;
    if (!state.isCorrect) {
      html += `<button class="btn btn-secondary" onclick="retryLater()">Repasser plus tard</button>`;
    }
    const label = state.idx + 1 >= total && state.retryQueue.length === 0 ? "Voir résultats" : "Suivant";
    html += `<button class="btn btn-primary" onclick="next()">${label}</button></div>`;
  }

  if (state.retryQueue.length > 0) {
    html += `<div class="retry-info">${state.retryQueue.length} question${state.retryQueue.length > 1 ? "s" : ""} à repasser en fin de série</div>`;
  }

  document.getElementById("quizScreen").innerHTML = html;
}

function renderResult() {
  const total = state.correct + state.wrong;
  const pct = total > 0 ? Math.round((state.correct / total) * 100) : 0;
  const grade = pct >= 90 ? "S" : pct >= 80 ? "A" : pct >= 70 ? "B" : pct >= 60 ? "C" : pct >= 50 ? "D" : "F";
  const gc = { S: "#111827", A: "#16a34a", B: "#16a34a", C: "#6b7280", D: "#dc2626", F: "#dc2626" }[grade];

  document.getElementById("resultScreen").innerHTML = `
    <div class="results">
      <div class="grade-circle"><span class="grade-letter" style="color:${gc}">${grade}</span></div>
      <div class="grade-label">Rang obtenu</div>
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-value" style="color:#111827">${pct}%</div><div class="stat-label">Score</div></div>
        <div class="stat-card"><div class="stat-value" style="color:#16a34a">${state.correct}/${total}</div><div class="stat-label">Correctes</div></div>
        <div class="stat-card"><div class="stat-value" style="color:#dc2626">${state.retryCount}</div><div class="stat-label">Reprises</div></div>
      </div>
      <div class="result-btns">
        <button class="btn btn-secondary" onclick="startSeries(${state.seriesNum})">Recommencer</button>
        <button class="btn btn-primary" onclick="goHome()">Accueil</button>
      </div>
    </div>`;
}
</script>
</body>
</html>
